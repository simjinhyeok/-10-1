\thispagestyle{empty}
\chapter[環境における人間の移動傾向導出システム]{環境における人間の移動傾向導出\\システム}
\label{chap2}
\minitoc

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{はじめに}
安全と効率とを両立させた移動ロボットの運用という最終的な目標を実現するために，本研究では人間の移動経路予測手法を提案する．
また，人間の移動は周囲の環境からの影響を受けており，移動経路予測においてはその環境からの影響を考慮にいれなくてはならない．\\

本章では，この環境からの影響を観測から導出する手法について述べる．
まず，\ref{idoukeiko_teigi} 節にて，人間の歩行が環境から受けた影響を人間の移動傾向として定義し，導出方法について述べる
その後，\ref{idokeikosystem} 節にて，導出した移動傾向をデータベースに蓄積していく手法について述べる．




\clearpage
\newpage


\section{移動傾向の定義}
\label{idoukeiko_teigi}
\ref{keiroyosoku} 項で述べたように，人間の移動経路を予測する上で，環境が人間の歩行に対して与える影響を考慮に入れなくてはならない．

ゴミ箱，本棚などといった人が向かって行きやすい場所，逆に人があまり通らない場所，などといった環境の持つ情報を読み取ることで，環境の人間の歩行に対する影響を導出しなくてはならない．
人間が日頃意識していないような影響もある可能性があり，この``環境からの影響''を人間の主観から求める事が望ましくないのは\ref{keiroyosoku} 項で述べた通りである．

\ref{settei} 節で述べた通り，本研究はLRFを用いる事を想定している．
光学カメラなどと違い，LRFで環境を測定した場合に得られるのは環境の形状のみであり，センサによる環境測定から環境の持つ意味を知り，歩行への影響を導出することは困難である．
そこで，環境を計測するのではなく，その環境における人間の歩行を計測し，得られた観測結果から環境から受けた影響を抽出することとした．
環境が人間の歩行に与える影響は人間の移動の変化に現れると考えられる．
そこで，ある環境のある場所において，人間の移動がどのように変化したのかを計測し，その変化を環境から影響を受けた結果と扱うこととする．
観測された歩行経路から，環境から受けたであろう影響を導出する概念図を図\ref{kiseki} に示す．

\begin{figure}[!h]
\begin{center}
\includegraphics[width=10cm]{chap2/kiseki.eps}
\end{center}
 \caption{環境による影響の導出}
 \label{kiseki}
\end{figure}


人間の移動の変化は，常に速度の変化によって表すことが出来る．
そこで，人間の移動を仮想的な質量$M {\rm [kg]}$ を持つ質点とみなすことで，速度の変化から仮想的な力積を導出することが出来る．
仮想的な力積は，図\ref{impulse} 及び式(\ref{siki_rikiseki})に従って導出される．


\begin{figure}[!h]
\begin{center}
\includegraphics[width=10cm]{chap2/impulse.eps}
\end{center}
 \caption{仮想的な力積}
 \label{impulse}
\end{figure}



\begin{equation}
\boldsymbol{I}= M(\boldsymbol{v}-\boldsymbol{v'})
\label{siki_rikiseki}
\end{equation}
\\
\[
\begin{cases}
\boldsymbol{I} & \text{:算出された力積} \\
\boldsymbol{v'} & \text{:変化前の速度} \\
\boldsymbol{v} & \text{:変化後の速度} \\
\end{cases}
\] \\

本研究においては，この仮想的な力積を，その環境の持つ人間の歩行への影響によって生じた``人間の移動傾向''として扱う．
その環境において活動する人間の歩行を継続的に計測し，その歩行から仮想的な力積を導出していく．
継続的に得られる人間の移動傾向というデータを蓄積することで，その環境における人間の歩行の特徴をとらえることとする．

\clearpage
\newpage

\section{人間の移動傾向導出システム}
\label{idokeikosystem}

\subsection{移動傾向データベースの概要}
\label{dbgaiyo}
\ref{idoukeiko_teigi} 節では，観測された人間の歩行経路から，環境中のある場所における人間の移動傾向を導出した．
この移動傾向は，その場所において環境がその歩行経路に与えた影響を表している．
長期的に人間の行き交う環境を観測し続け，歩行経路が得られる度に移動傾向を導出し蓄積していくことで，環境中のその場所における``環境の影響''を表現することができる．
そのため，長期的な観測を行い，得られた移動傾向を``移動傾向データベース''に蓄積することとする．\\

システムを適用する環境を一辺$d_{c} \rm{[m]}$の正方形のセルに区切り，それぞれのセルについて移動傾向データベースを生成する．
それぞれのデータベースには，そのセル上で得られた人間の移動傾向，つまり\ref{idoukeiko_teigi} 節で導出された仮想的な力積が記録される．
同じセルの中で起こる速度変化の中でも，かかる力積の方向は速度変化前の速度に大きく影響される．
そのため，速度変化前の速度$\boldsymbol{v}_{j}$と，得られた力積$\boldsymbol{I}_{j}$とを一組として記録していく．
また，移動傾向データベースによって表現される環境からの歩行への影響を新しく保つため，データ保持数に上限$J$を設定し，新しい移動傾向が観測されるに従って古い移動傾向を破棄していく．
セル$C_{pq}$に記録されるデータを式(\ref{cmn})に示す．
データベースにデータが記録される概念図を図\ref{mn} に示す．
図\ref{mn} は，環境中のあるセル$C_{pq}$で，3回の速度変化が観測された場合を表している．


\begin{equation}
C_{pq} = \{ \boldsymbol{I}_{j} , \boldsymbol{v}_{j}| 0<j\leq {\it J}, j \in {\bf Z}\}
\label{cmn}
\end{equation}


\[
\begin{cases}
C_{pq}& \text{:セル$C_{pq}$に記録されるデータの集合} \\
{\it J} & \text{:1つのセルに記録されるデータ数の最大値} \\
\end{cases}
\] \\


\begin{figure}[!h]
\begin{center}
\includegraphics[width=10cm]{chap2/mn.eps}
\end{center}
 \caption{データベースへの記録}
 \label{mn}
\end{figure}


こうして得られたデータベースは，後述する人間の移動経路予測アルゴリズムにおいて，環境からの影響を考慮に入れた予測を実現するために参照される．

\clearpage
\newpage
\subsection{地図情報からの初期移動傾向データベースの生成}
\label{syokidbsakusei}
\ref{dbgaiyo} 項にて，データベースの生成について述べたが，データベースを生成するためには一定の観測が必要である．
しかし，\ref{keiroyosoku} 項で述べたように，膨大な観測がなければ適用できないシステムは不完全である．
そのため，まずデータベースの初期値となる初期移動傾向データベースを生成し，その後観測によってデータベースを更新していくこととする．\\

初期移動傾向データベースを生成するうえで，地図情報を用いる事とする．
\ref{settei} 節で述べたように，本研究ではLRFの使用を想定しており，環境の形状であれば長期間の観測を必要とせずに得ることができる．

人間が環境から受ける影響の一部として，人間は通路などを進む際には通路の方向に沿うように進む，という影響がある．
初期移動データベース生成の際には，この影響に着目する．
壁（障害物）からの仮想的な斥力を想定してデータベースの初期値として与えることとする．\\

あるセル$C_{pq}$における初期データベースについて，以下の式(\ref{syoki})に従って初期データベースを生成する．

\begin{equation}
C_{pq} = \{ \boldsymbol{I}_{j} , \boldsymbol{v}_{j}| 0<j\leq {\it J}, j \in {\bf Z}\}
\label{syoki}
\end{equation}

\begin{equation}
\boldsymbol{I}_{j} =	\begin{cases}
			\frac{ \rho_{s}}{d}  \bf{n} & \text{進行方向に壁がある場合}\\
			\boldsymbol{0}& \text{進行方向に壁がない場合}
		\end{cases}
\end{equation}

\[
\begin{cases}
v_{j_{\theta}}　= j \frac{2 \pi}{J} \\ 
v_{j_{r}}　= v_{s}\\
\end{cases}
\]

\[
\begin{cases}
d & \text{:壁との距離} \\ 
v_{j_{\theta}} & \text{:登録される速度の角度成分} \\
v_{j_{r}} & \text{:登録される速度のノルム成分} \\
v_{s} & \text{:速度成分の初期値} \\
\rho_{s}  &\text{:定数} \\
\boldsymbol{n} & \text{:進行方向にある壁の単位法線ベクトル} \\
\end{cases}
\] 
\\

初期移動傾向データベース生成の概念図を図\ref{syokidata} に示す．


\begin{figure}[!h]
\begin{center}
\includegraphics[width=10cm]{chap2/syokidata.eps}
\end{center}
 \caption{初期移動傾向データベース生成の概念図}
 \label{syokidata}
\end{figure}


得られた初期移動傾向データベースは，観測による更新の初期値となるデータベースであり，これだけで環境における人間の歩行への影響を十分に表せているわけではない．
しかし，継続的な観測を必要とせずに，環境の形状が人間の歩行に与える影響をデータベースに登録することができる．
次項にて，実際の観測で初期データベースの更新方法について説明する．

\clearpage
\newpage
\subsection{観測による環境に即した移動傾向データベースの生成}
\ref{syokidbsakusei} 項で，センサによって得られた環境の形状から，移動傾向データベースに初期値を与えた．
LRFによる環境測定で得られる地図情報は壁などの幾何学的な位置情報のみであり，たとえばそこに案内板が存在するなどといった環境の持つ意味に由来する環境の影響は初期移動データベースで得ることはできてない．
そこで，環境に設置したセンサで人間の移動を継続的に観測し，移動傾向データベースを更新していく．\\

ここでは，データベースの更新則について説明する．
ある速度$\boldsymbol{v}$でそのセルに移動してきた人間が，``どのように速度を変更したか''つまりは，``どのような移動傾向を見せたか''，がデータベースに記録されている移動傾向である．
そこで，移動傾向を導出する前の$\boldsymbol{v}$の角度成分$\boldsymbol{v}_{\theta}$に着目することとした．\\
 
 まず，\ref{syokidbsakusei} 項で生成した初期移動傾向データベースには，それぞれ$J$個のデータが記録されている．
セルの中心点より周囲$360^\circ$を$\boldsymbol{n}$領域に分割し，データベース中それぞれのデータの持つ速度の角度成分と比較する．
すると，ある角度領域に含まれる角度成分を持つデータは$\frac{J}{n}$個存在することとなる．
継続的な観測中に移動傾向が観測され，新たなデータ$\{ \boldsymbol{I} , \boldsymbol{v} \}$を記録する時，既に$J$個のデータが記録されているため，1つのデータを削除しなくてはならない．
新たなデータの角度成分$\boldsymbol{v}_{\theta}$が含まれる角度領域を求め，その角度領域に含まれる$\frac{J}{n}$のデータのうち，最も古いものを削除し，新たなデータをデータベースに登録する．

データベース更新の概念図を\ref{newdata} に示す．

\begin{figure}[!h]
\begin{center}
\includegraphics[width=12cm]{chap2/newdata.eps}
\end{center}
 \caption{データベースの更新}
 \label{newdata}
\end{figure}



\clearpage
\newpage

\section{おわりに}
本章では，この環境からの影響を観測から導出する手法について述べた．\\

人間の歩行が環境が受ける影響を表現するため，人間の移動傾向を定義し，導出方法について述べた．
また，継続的な観測によって得られた移動傾向を，データベースに蓄積する方法について述べた．
データベース生成においては，膨大な観測を必須のものとしないため，環境の形状から初期データベース生成し，その後継続的な観測によって更新していくシステムとした，
本章において生成された移動傾向データベースは，\ref{chap3}章にて述べられる人間の移動経路予測において利用される．\\


\clearpage
\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Local Variables:
%%% mode: katex
%%% TeX-master: "../thesis"
%%% End:
